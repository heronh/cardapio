<!DOCTYPE html>
<html lang="pt-BR"> 

{{ template "head" . }}

<body>
<div class="container m-3">

{{ template "navbar" . }}

<div class="card">
    <div class="card-header">
        <h5>Seus pratos</h5>
    </div>
    <div class="card-body">

        {{ if not .Dishes }}
        <div class="alert alert-warning" role="alert">
            <p>Você ainda não cadastrou nenhum prato.</p>
            <p>Gostaria que criassemos alguns pratos para você como exemplo?</p>
            <button id="btn-create-dishes" class="btn btn-link">Criar pratos</button>
        </div>
        {{ else}}

        <ul class="list-group">
            {{ range .Dishes }}
                {{ template "admin-list-dish" . }}
            {{ end }}
            <li class="list-group-item">
                <button class="btn btn-primary" id="btn-create-dishes">Criar pratos</button>
            </li>
        </ul>
        {{ end }}

    </div>
</div>

<input id="current-user-id" value="{{ .UserId }}" hidden />
<input id="current-company-id" value="{{ .CompanyId }}" hidden />

{{ template "footer" . }}

</div>

<script>
  $(document).ready(function() {
    //$('#description').focus();
    //$('html, body').animate({ scrollTop: 0 }, 'fast');
  });

  $('#btn-create-dishes').click(function() {

    const CompanyId = $('#current-company-id').val();
    const UserId = $('#current-user-id').val();
    fetch('/create-dishes', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
            body: JSON.stringify({CompanyId:parseInt(CompanyId), UserId:parseInt(UserId)})
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                showAlert(data.message, 5000);
            } else if (data.error) {
                alert(data.error);
            }
        });
    });

    function showAlert(message, duration) {
        // Create a new div element for the alert
        const alertDiv = document.createElement('div');
        alertDiv.classList.add('alert', 'alert-info'); // Add CSS classes for styling
        alertDiv.textContent = message;

        // Append the alert to the body
        document.body.appendChild(alertDiv);

        // Remove the alert after the specified duration
        setTimeout(() => {
            alertDiv.remove();
            window.location.href = '/admin';
        }, duration);
    }

</script>